<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:replace="~{fragments/head :: head-links}"></th:block>
    <title>Mis Reservas - TGSMAX CARS</title>
    <style>
        :root{--red:#e74c3c;--blue:#0b5ed7;--muted:#6c757d;--white:#ffffff;--success:#198754;--warning:#ffc107;--danger:#dc3545;--info:#0dcaf0}
        
        .reservas-container {
            background: #f8f9fa;
            min-height: 100vh;
            padding: 20px 0;
        }

        .reservas-header {
            background: linear-gradient(135deg, var(--red) 0%, #c0392b 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(231, 76, 60, 0.2);
        }

        .reservas-header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .reservas-header .breadcrumb {
            background: transparent;
            padding: 0;
            margin: 0;
        }

        .reservas-header .breadcrumb-item a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
        }

        .reservas-header .breadcrumb-item.active {
            color: white;
        }

        .filters-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .filter-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            background: white;
            color: var(--muted);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            border-color: var(--red);
            color: var(--red);
            text-decoration: none;
        }

        .filter-btn.active {
            background: var(--red);
            border-color: var(--red);
            color: white;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .stat-card .icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 20px;
        }

        .stat-card .number {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: var(--muted);
            font-size: 0.9rem;
        }

        .reservas-list {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .reserva-item {
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .reserva-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--muted);
        }

        .reserva-item.confirmada::before { background: var(--success); }
        .reserva-item.pendiente::before { background: var(--warning); }
        .reserva-item.cancelada::before { background: var(--danger); }
        .reserva-item.completada::before { background: var(--info); }

        .reserva-item:hover {
            border-color: var(--red);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.1);
            transform: translateY(-2px);
        }

        .reserva-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .reserva-id {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--blue);
        }

        .estado-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .estado-confirmada { background: rgba(25, 135, 84, 0.1); color: var(--success); }
        .estado-pendiente { background: rgba(255, 193, 7, 0.1); color: var(--warning); }
        .estado-cancelada { background: rgba(220, 53, 69, 0.1); color: var(--danger); }
        .estado-completada { background: rgba(13, 202, 240, 0.1); color: var(--info); }

        .reserva-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .detail-group {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }

        .detail-group .title {
            font-size: 0.8rem;
            color: var(--muted);
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .detail-group .value {
            font-size: 1rem;
            font-weight: 500;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-group .icon {
            color: var(--red);
        }

        .reserva-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-sm {
            padding: 6px 15px;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted);
        }

        .empty-state .icon {
            font-size: 5rem;
            opacity: 0.2;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            color: var(--muted);
            margin-bottom: 15px;
        }

        .pagination-wrapper {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .reservas-container {
                padding: 15px;
            }
            
            .reservas-header {
                padding: 20px;
            }
            
            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-btn {
                text-align: center;
            }
            
            .reserva-details {
                grid-template-columns: 1fr;
            }
            
            .reserva-actions {
                justify-content: stretch;
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <header th:replace="~{fragments/header :: main-header}"></header>

    <div class="reservas-container">
        <div class="container">
            <!-- Header con breadcrumb -->
            <div class="reservas-header">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="/dashboard"><i class="fa-solid fa-dashboard me-1"></i>Dashboard</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Mis Reservas</li>
                    </ol>
                </nav>
                <h1><i class="fa-solid fa-calendar-check me-3"></i>Mis Reservas</h1>
                <p>Consulta el estado y detalles de todas tus reservas</p>
            </div>

            <!-- Filtros -->
            <div class="filters-card">
                <h5 class="mb-3"><i class="fa-solid fa-filter me-2"></i>Filtrar por Estado</h5>
                <div class="filter-group">
                    <a href="/reservas" class="filter-btn" th:classappend="${estadoFiltro == null or estadoFiltro == ''} ? 'active' : ''">
                        <i class="fa-solid fa-list me-1"></i> Todas
                    </a>
                    <a href="/reservas?estado=confirmada" class="filter-btn" th:classappend="${estadoFiltro == 'confirmada'} ? 'active' : ''">
                        <i class="fa-solid fa-check-circle me-1"></i> Confirmadas
                    </a>
                    <a href="/reservas?estado=pendiente" class="filter-btn" th:classappend="${estadoFiltro == 'pendiente'} ? 'active' : ''">
                        <i class="fa-solid fa-clock me-1"></i> Pendientes
                    </a>
                    <a href="/reservas?estado=completada" class="filter-btn" th:classappend="${estadoFiltro == 'completada'} ? 'active' : ''">
                        <i class="fa-solid fa-flag-checkered me-1"></i> Completadas
                    </a>
                    <a href="/reservas?estado=cancelada" class="filter-btn" th:classappend="${estadoFiltro == 'cancelada'} ? 'active' : ''">
                        <i class="fa-solid fa-times-circle me-1"></i> Canceladas
                    </a>
                </div>
            </div>

            <!-- Estadísticas -->
            <div class="stats-overview">
                <div class="stat-card">
                    <div class="icon" style="background: var(--blue);">
                        <i class="fa-solid fa-list"></i>
                    </div>
                    <div class="number" th:text="${estadisticas.totalReservas}">0</div>
                    <div class="label">Total</div>
                </div>
                
                <div class="stat-card">
                    <div class="icon" style="background: var(--success);">
                        <i class="fa-solid fa-check-circle"></i>
                    </div>
                    <div class="number" th:text="${estadisticas.reservasActivas}">0</div>
                    <div class="label">Activas</div>
                </div>
                
                <div class="stat-card">
                    <div class="icon" style="background: var(--info);">
                        <i class="fa-solid fa-flag-checkered"></i>
                    </div>
                    <div class="number" th:text="${estadisticas.reservasCompletadas}">0</div>
                    <div class="label">Completadas</div>
                </div>
                
                <div class="stat-card">
                    <div class="icon" style="background: var(--warning);">
                        <i class="fa-solid fa-dollar-sign"></i>
                    </div>
                    <div class="number" th:text="'$' + ${#numbers.formatDecimal(estadisticas.gastoTotal, 0, 2)}">$0.00</div>
                    <div class="label">Gastado</div>
                </div>
            </div>

            <!-- Lista de Reservas -->
            <div class="reservas-list">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4><i class="fa-solid fa-calendar-alt me-2"></i>Lista de Reservas</h4>
                    <a href="/" class="btn btn-primary">
                        <i class="fa-solid fa-plus me-2"></i>Nueva Reserva
                    </a>
                </div>

                <!-- Estado vacío -->
                <div th:if="${#lists.isEmpty(reservas)}" class="empty-state">
                    <div class="icon">
                        <i class="fa-regular fa-calendar"></i>
                    </div>
                    <h3>No se encontraron reservas</h3>
                    <p th:if="${estadoFiltro != null and estadoFiltro != ''}">
                        No tienes reservas con estado "<span th:text="${estadoFiltro}" style="text-transform: capitalize;"></span>"
                    </p>
                    <p th:if="${estadoFiltro == null or estadoFiltro == ''}">
                        Aún no has hecho ninguna reserva. ¡Comienza ahora y disfruta de nuestros servicios!
                    </p>
                    <a href="/" class="btn btn-primary mt-3">
                        <i class="fa-solid fa-plus me-2"></i>Hacer mi Primera Reserva
                    </a>
                </div>

                <!-- Lista de reservas -->
                <div th:if="${!#lists.isEmpty(reservas)}">
                    <div th:each="reserva : ${reservas}" 
                         class="reserva-item"
                         th:classappend="${#strings.toLowerCase(reserva.estado.name())}">
                         
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="reserva-id">
                                <i class="fa-solid fa-hashtag me-1"></i>
                                Reserva #<span th:text="${reserva.id_reserva}">001</span>
                            </div>
                            <span class="estado-badge" 
                                  th:classappend="'estado-' + ${#strings.toLowerCase(reserva.estado.name())}"
                                  th:text="${reserva.estado.name()}">CONFIRMADA</span>
                        </div>

                        <div class="reserva-details">
                            <div class="detail-group">
                                <div class="title">Fecha de Inicio</div>
                                <div class="value">
                                    <i class="fa-solid fa-calendar-start icon"></i>
                                    <span th:text="${#temporals.format(reserva.fecha_inicio, 'dd/MM/yyyy')}">01/12/2024</span>
                                </div>
                            </div>
                            
                            <div class="detail-group">
                                <div class="title">Fecha de Fin</div>
                                <div class="value">
                                    <i class="fa-solid fa-calendar-end icon"></i>
                                    <span th:text="${#temporals.format(reserva.fecha_fin, 'dd/MM/yyyy')}">05/12/2024</span>
                                </div>
                            </div>
                            
                            <div class="detail-group">
                                <div class="title">Precio Total</div>
                                <div class="value">
                                    <i class="fa-solid fa-dollar-sign icon"></i>
                                    <span th:text="'$' + ${#numbers.formatDecimal(reserva.precio_reserva, 0, 2)}">$150.00</span>
                                </div>
                            </div>
                            
                            <div class="detail-group">
                                <div class="title">Sucursal</div>
                                <div class="value">
                                    <i class="fa-solid fa-building icon"></i>
                                    <span th:text="${reserva.telefonoSucursal}">Sucursal Central</span>
                                </div>
                            </div>
                        </div>

                        <div class="reserva-actions">
                            <a th:href="@{/reservas/{id}(id=${reserva.id_reserva})}" 
                               class="btn btn-outline-primary btn-sm">
                                <i class="fa-solid fa-eye me-1"></i>Ver Detalles
                            </a>
                            
                            <!-- Mostrar acciones según el estado -->
                            <button th:if="${reserva.estado.name() == 'PENDIENTE'}" 
                                    class="btn btn-outline-danger btn-sm"
                                    onclick="cancelarReserva(this.getAttribute('data-id'))"
                                    th:attr="data-id=${reserva.id_reserva}">
                                <i class="fa-solid fa-times me-1"></i>Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer th:replace="~{fragments/footer :: main-footer}"></footer>
    
    <!-- Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Animaciones de entrada
            const reservaItems = document.querySelectorAll('.reserva-item');
            reservaItems.forEach((item, index) => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    item.style.transition = 'all 0.5s ease';
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }, index * 100);
            });
            
            // Animación de estadísticas
            const numbers = document.querySelectorAll('.stat-card .number');
            numbers.forEach(number => {
                const finalValue = parseInt(number.textContent.replace(/\$|,/g, '')) || 0;
                if (finalValue > 0) {
                    animateNumber(number, 0, finalValue, 1000);
                }
            });
        });
        
        function animateNumber(element, start, end, duration) {
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= end) {
                    current = end;
                    clearInterval(timer);
                }
                
                if (element.textContent.includes('$')) {
                    element.textContent = '$' + Math.floor(current).toLocaleString();
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 16);
        }
        
        function cancelarReserva(reservaId) {
            if (confirm('¿Está seguro que desea cancelar esta reserva? Esta acción no se puede deshacer.')) {
                // Aquí se implementaría la llamada AJAX para cancelar la reserva
                fetch(`/api/reservas/${reservaId}/cancelar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('Error al cancelar la reserva. Por favor, intente nuevamente.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cancelar la reserva. Por favor, intente nuevamente.');
                });
            }
        }
    </script>
</body>

</html>