<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Vehículo</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto;
            background: linear-gradient(180deg, #f7fbff 0%, #f0f5ff 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        .container-main {
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 12px 30px rgba(13, 18, 43, 0.06);
            margin-bottom: 1.5rem;
        }
        .card-header {
            background: linear-gradient(135deg, #2b6ef6 0%, #7b4de2 100%);
            color: white;
            border-radius: 12px 12px 0 0 !important;
            padding: 1.5rem;
        }
        .vehicle-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 8px;
        }
        .vehicle-image-placeholder {
            width: 100%;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 6rem;
            border-radius: 8px;
        }
        .info-label {
            font-weight: 600;
            color: #6b7280;
            font-size: 0.875rem;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }
        .info-value {
            font-size: 1.125rem;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        .badge-disponible {
            background: #34d399;
            color: #065f46;
            padding: 0.5rem 1rem;
            font-size: 1rem;
        }
        .badge-reservado {
            background: #fbbf24;
            color: #78350f;
            padding: 0.5rem 1rem;
            font-size: 1rem;
        }
        .badge-entregado {
            background: #3b82f6;
            color: #1e3a8a;
            padding: 0.5rem 1rem;
            font-size: 1rem;
        }
        .badge-descompuesto {
            background: #f87171;
            color: #7f1d1d;
            padding: 0.5rem 1rem;
            font-size: 1rem;
        }
        .spec-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        .spec-icon {
            font-size: 2rem;
            color: #2b6ef6;
            margin-bottom: 0.5rem;
        }
        .spec-label {
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
        }
        .spec-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2b6ef6;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }
        .cliente-card {
            background: #fff7ed;
            border-left: 4px solid #f59e0b;
            padding: 1.25rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        .reserva-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .badge-pendiente {
            background: #fef3c7;
            color: #92400e;
        }
        .badge-aceptada {
            background: #d1fae5;
            color: #065f46;
        }
        .badge-cancelada {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <div class="container container-main">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/admin/dashboard}">Dashboard</a></li>
                <li class="breadcrumb-item"><a th:href="@{/admin/vehiculos}">Vehículos</a></li>
                <li class="breadcrumb-item active" aria-current="page">Detalle</li>
            </ol>
        </nav>

        <!-- Header con acciones -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="mb-0">
                <i class="bi bi-car-front-fill me-2"></i>
                <span th:text="${vehiculo.marca + ' ' + vehiculo.modelo}">Toyota Corolla</span>
            </h2>
            <div class="d-flex gap-2">
                <a th:href="@{/admin/vehiculos/{id}/editar(id=${vehiculo.idVehiculo})}" class="btn btn-primary">
                    <i class="bi bi-pencil me-1"></i>
                    Editar
                </a>
                <a th:href="@{/admin/vehiculos}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left me-1"></i>
                    Volver
                </a>
            </div>
        </div>

        <!-- Imagen del vehículo -->
        <div class="card">
            <div class="card-body p-4">
                <div th:if="${vehiculo.imagenUrl != null && !#strings.isEmpty(vehiculo.imagenUrl)}">
                    <img th:src="${vehiculo.imagenUrl}"
                         th:alt="${vehiculo.marca + ' ' + vehiculo.modelo}"
                         class="vehicle-image"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="vehicle-image-placeholder" style="display: none;">
                        <i class="bi bi-car-front"></i>
                    </div>
                </div>
                <div th:if="${vehiculo.imagenUrl == null || #strings.isEmpty(vehiculo.imagenUrl)}"
                     class="vehicle-image-placeholder">
                    <i class="bi bi-car-front"></i>
                </div>
            </div>
        </div>

        <!-- Información básica -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-info-circle me-2"></i>
                    Información General
                </h5>
            </div>
            <div class="card-body p-4">
                <div class="row">
                    <div class="col-md-3">
                        <div class="info-label">Patente</div>
                        <div class="info-value" th:text="${vehiculo.patente}">ABC123</div>
                    </div>
                    <div class="col-md-3">
                        <div class="info-label">Marca</div>
                        <div class="info-value" th:text="${vehiculo.marca}">Toyota</div>
                    </div>
                    <div class="col-md-3">
                        <div class="info-label">Modelo</div>
                        <div class="info-value" th:text="${vehiculo.modelo}">Corolla</div>
                    </div>
                    <div class="col-md-3">
                        <div class="info-label">Color</div>
                        <div class="info-value" th:text="${vehiculo.color}">Blanco</div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="info-label">Estado Actual</div>
                        <div>
                            <span class="badge"
                                  th:classappend="${vehiculo.estado.name() == 'DISPONIBLE' ? 'badge-disponible' :
                                                  (vehiculo.estado.name() == 'RESERVADO' ? 'badge-reservado' :
                                                  (vehiculo.estado.name() == 'ENTREGADO' ? 'badge-entregado' : 'badge-descompuesto'))}"
                                  th:text="${vehiculo.estado.name()}">
                                DISPONIBLE
                            </span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-label">Precio por Día</div>
                        <div class="info-value text-success">
                            $<span th:text="${#numbers.formatDecimal(vehiculo.precioDiario, 1, 'COMMA', 2, 'POINT')}">0.00</span>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-12">
                        <div class="info-label">Descripción</div>
                        <div class="info-value" th:text="${vehiculo.descripcion}">Descripción del vehículo...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Especificaciones técnicas -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-gear-fill me-2"></i>
                    Especificaciones Técnicas
                </h5>
            </div>
            <div class="card-body p-4">
                <div class="row g-3">
                    <div class="col-md-3 col-6">
                        <div class="spec-card">
                            <div class="spec-icon"><i class="bi bi-gear"></i></div>
                            <div class="spec-label">Tipo de Motor</div>
                            <div class="spec-value" th:text="${vehiculo.motor.tipoMotor.name()}">Manual</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="spec-card">
                            <div class="spec-icon"><i class="bi bi-fuel-pump"></i></div>
                            <div class="spec-label">Combustible</div>
                            <div class="spec-value" th:text="${vehiculo.motor.tipoCombustible.name()}">Nafta</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="spec-card">
                            <div class="spec-icon"><i class="bi bi-speedometer2"></i></div>
                            <div class="spec-label">Potencia</div>
                            <div class="spec-value" th:text="${vehiculo.motor.caballosDeFuerza + ' HP'}">150 HP</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="spec-card">
                            <div class="spec-icon"><i class="bi bi-speedometer"></i></div>
                            <div class="spec-label">Cilindrada</div>
                            <div class="spec-value" th:text="${vehiculo.motor.cilindrada + ' L'}">2.0 L</div>
                        </div>
                    </div>
                </div>

                <div class="row g-3 mt-2">
                    <div class="col-md-4 col-6">
                        <div class="spec-card">
                            <div class="spec-icon"><i class="bi bi-door-closed"></i></div>
                            <div class="spec-label">Puertas</div>
                            <div class="spec-value" th:text="${vehiculo.cantPuertas}">4</div>
                        </div>
                    </div>
                    <div class="col-md-4 col-6">
                        <div class="spec-card">
                            <div class="spec-icon"><i class="bi bi-tag"></i></div>
                            <div class="spec-label">Tipo</div>
                            <div class="spec-value" th:text="${vehiculo.tipoVehiculo.tipo}">Sedan</div>
                        </div>
                    </div>
                    <div class="col-md-4 col-12">
                        <div class="spec-card">
                            <div class="spec-icon"><i class="bi bi-geo-alt"></i></div>
                            <div class="spec-label">Sucursal</div>
                            <div class="spec-value" th:text="${vehiculo.sucursal.nombre}">Centro</div>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <div class="info-label">Características del Tipo</div>
                        <div class="info-value" th:text="${vehiculo.tipoVehiculo.caracteristicas}">Características...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Información de alquiler (solo si está reservado o entregado) -->
        <div th:if="${reservaActual != null}" class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-calendar-check me-2"></i>
                    Información de Alquiler Actual
                </h5>
            </div>
            <div class="card-body p-4">
                <!-- Información del cliente -->
                <div class="cliente-card">
                    <h6 class="mb-3">
                        <i class="bi bi-person-circle me-2"></i>
                        Cliente
                    </h6>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-label">Nombre Completo</div>
                            <div class="info-value" th:text="${reservaActual.usuario.nombre + ' ' + reservaActual.usuario.apellido}">
                                Juan Pérez
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-label">Email</div>
                            <div class="info-value" th:text="${reservaActual.usuario.email}">cliente@email.com</div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-6">
                            <div class="info-label">DNI</div>
                            <div class="info-value" th:text="${reservaActual.usuario.dni}">12345678</div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-label">Teléfono</div>
                            <div class="info-value" th:text="${reservaActual.usuario.telefono}">123-456-7890</div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-12">
                            <div class="info-label">Dirección</div>
                            <div class="info-value" th:text="${reservaActual.usuario.direccion}">Calle Falsa 123</div>
                        </div>
                    </div>
                </div>

                <!-- Información de la reserva -->
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="info-label">Estado de Reserva</div>
                        <div>
                            <span class="reserva-badge"
                                  th:classappend="${reservaActual.estado.name() == 'PENDIENTE' ? 'badge-pendiente' :
                                                  (reservaActual.estado.name() == 'ACEPTADA' ? 'badge-aceptada' : 'badge-cancelada')}"
                                  th:text="${reservaActual.estado.name()}">
                                PENDIENTE
                            </span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-label">Fecha de Inicio</div>
                        <div class="info-value" th:text="${#temporals.format(reservaActual.fechaInicio, 'dd/MM/yyyy')}">01/01/2024</div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-label">Fecha de Fin</div>
                        <div class="info-value" th:text="${#temporals.format(reservaActual.fechaFin, 'dd/MM/yyyy')}">10/01/2024</div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="info-label">Precio Total</div>
                        <div class="info-value text-success">
                            $<span th:text="${#numbers.formatDecimal(reservaActual.precio, 1, 'COMMA', 2, 'POINT')}">0.00</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-label">Método de Pago</div>
                        <div class="info-value" th:text="${reservaActual.metodoPago.name()}">EFECTIVO</div>
                    </div>
                    <div class="col-md-4">
                        <div class="info-label">ID Reserva</div>
                        <div class="info-value" th:text="${'#' + reservaActual.idReserva}">#123</div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="info-label">Sucursal de Retiro</div>
                        <div class="info-value">
                            <i class="bi bi-geo-alt me-1"></i>
                            <span th:text="${reservaActual.sucursalRetiro.nombre}">Centro</span>
                        </div>
                        <div class="text-muted small" th:text="${reservaActual.sucursalRetiro.direccion}">Dirección</div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-label">Sucursal de Devolución</div>
                        <div class="info-value">
                            <i class="bi bi-geo-alt me-1"></i>
                            <span th:text="${reservaActual.sucursalDevolucion.nombre}">Norte</span>
                        </div>
                        <div class="text-muted small" th:text="${reservaActual.sucursalDevolucion.direccion}">Dirección</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Historial de reservas -->
        <div th:if="${!#lists.isEmpty(todasReservas)}" class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-clock-history me-2"></i>
                    Historial de Reservas
                </h5>
            </div>
            <div class="card-body p-4">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Cliente</th>
                                <th>Fechas</th>
                                <th>Estado</th>
                                <th>Precio</th>
                                <th>Método Pago</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="reserva : ${todasReservas}">
                                <td th:text="${'#' + reserva.idReserva}">#123</td>
                                <td th:text="${reserva.usuario.nombre + ' ' + reserva.usuario.apellido}">Cliente</td>
                                <td>
                                    <span th:text="${#temporals.format(reserva.fechaInicio, 'dd/MM/yyyy')}">01/01</span> -
                                    <span th:text="${#temporals.format(reserva.fechaFin, 'dd/MM/yyyy')}">10/01</span>
                                </td>
                                <td>
                                    <span class="reserva-badge"
                                          th:classappend="${reserva.estado.name() == 'PENDIENTE' ? 'badge-pendiente' :
                                                          (reserva.estado.name() == 'ACEPTADA' ? 'badge-aceptada' : 'badge-cancelada')}"
                                          th:text="${reserva.estado.name()}">
                                        PENDIENTE
                                    </span>
                                </td>
                                <td>$<span th:text="${#numbers.formatDecimal(reserva.precio, 1, 'COMMA', 2, 'POINT')}">0.00</span></td>
                                <td th:text="${reserva.metodoPago.name()}">EFECTIVO</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Mensaje si no hay reservas -->
        <div th:if="${#lists.isEmpty(todasReservas)}" class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-clock-history me-2"></i>
                    Historial de Reservas
                </h5>
            </div>
            <div class="card-body p-4 text-center">
                <i class="bi bi-inbox" style="font-size: 3rem; color: #cbd5e1;"></i>
                <p class="text-muted mt-3">Este vehículo no tiene reservas registradas</p>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
